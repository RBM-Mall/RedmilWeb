@model IEnumerable<Project_Redmil_MVC.Models.ResponseModel.DMT2ResponseModel.FinoDMTResponseModel.FinoDMTModel>

@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers


@using Project_Redmil_MVC
@using Project_Redmil_MVC.Models
@{
    ViewData["Title"] = "Business Report - Online My Business Report";
    Layout = "~/Pages/Shared/_LayoutMaster.cshtml";
}
<link rel="stylesheet" href="~/css/businessReport.css" asp-append-version="true" />
<link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap4.min.css" asp-append-version="true">
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.min.css" asp-append-version="true">
<link href="https://cdn.datatables.net/rowreorder/1.3.2/css/rowReorder.dataTables.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/responsive/2.4.0/css/responsive.dataTables.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.13.2/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/rowreorder/1.3.2/js/dataTables.rowReorder.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.4.0/js/dataTables.responsive.min.js"></script>
<link href="~/ResponsiveCSS/ServicesNavigation.css" rel="stylesheet" />
<link href="~/ResponsiveCSS/Index.css" rel="stylesheet" />
<br />
<br />
<br />
<br />
<br />
<!-- Table for Recepient List-->
<div class="container-fluid">
    <h2 style="text-align:center;font-weight:800; text-decoration: underline; margin-bottom: 30px; color: #2d385e;">DMT 2.0</h2>

    @*<div style="background:#ebebeb">*@
    <div class="row">
        <div class="col-md-12">

            @*<div style="overflow-x: auto; overflow-y: auto; white-space: nowrap;">*@
            <div>
                @*<table id="example" class="table table-striped table-bordered table-responsive wrapper dataTable no-footer" style="margin-left:27px !important;">*@
                <table id="example" class="table table-striped table-bordered table-responsive wrapper dataTable no-footer">
                    <thead style="color: #fff; background-color: #2d385e;">
                        <tr>
                            <th>Sr No.</th>
                            <th>Sender Name</th>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Mobile Number</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Bank RRN Number</th>
                            <th>Redmil Tansaction ID</th>
                            <th>Transaction ID</th>
                            <th>Client Unique ID</th>
                            <th>Wallet Type</th>
                            <th>Commision</th>
                            <th>Receiver Name</th>
                            <th>Bank Charges</th>
                            <th>Receiver Bank Name</th>
                            <th>Receiver Account Number</th>
                            <th>Receiver IFSC Code</th>
                            <th>Receiver Mobile Number</th>
                            <th>Transaction Type</th>
                            <th>Failure Reason</th>
                            <th>DE Name</th>
                            <th>DE Mobile</th>
                            <th>Request Id</th>
                            <th>Surcharge</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{
                            int rowNo = 0;
                        }
                        @if (Model != null)
                        {
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td>
                                        @(rowNo += 1)
                                    </td>
                                    <td style="font-weight:700">
                                        @item.SenderName
                                    </td>
                                    <td>
                                        @item.RequestDate
                                    </td>
                                    <td>
                                        @item.RequestTime
                                    </td>
                                    <td style="font-weight:700">
                                        @item.SenderMobileNumber
                                    </td>
                                    @if (@item.Status == "Success")
                                    {
                                        <td style="font-weight:700;color: green" width="15%">₹@item.TransactionAmount</td>
                                    }
                                    else
                                    {
                                        <td style="font-weight:700;color: #d9534f" width="15%">₹@item.TransactionAmount</td>
                                    }
                                    @if (item.Status == "Success")
                                    {
                                        <td> <button type="button" class="btn-process-recharge1 btn-process-recharge2" style="background-color:green;color:white;font-weight:700;border-color: aliceblue;padding: 3px 16px;">@item.Status</button></td>
                                    }
                                    else
                                    {
                                        <td>
                                            <button type="button" class="btn-process-recharge1 btn-process-recharge2" style="background-color:#d9534f;color:white;font-weight:700;border-color: aliceblue;padding: 3px 16px;">@item.Status</button>
                                        </td>
                                    }

                                    <td>
                                        @item.BankRRNNumber
                                    </td>
                                    <td>
                                        @item.RedmilReferenceId
                                    </td>
                                    <td>
                                        @item.TransactionID
                                    </td>
                                    <td>
                                        @item.ClientUniqueId

                                    </td>
                                    <td>
                                        @item.WalletType
                                    </td>
                                    <td>
                                        @item.CommissionAmount
                                    </td>
                                    <td>
                                        @item.ReceiverName
                                    </td>
                                    <td>
                                        @item.BankCharges
                                    </td>
                                    <td>
                                        @item.BankName
                                    </td>
                                    <td>
                                        @item.ReceiverAccountNo
                                    </td>
                                    <td>
                                        @item.IFSCCode
                                    </td>
                                    <td>
                                        @item.ReceiverMobileNumber
                                    </td>
                                    <td>
                                        @item.TransactionType
                                    </td>
                                    <td>
                                        @item.Reason
                                    </td>
                                    <td>
                                        @item.DEName
                                    </td>
                                    <td>
                                        @item.DEMobile
                                    </td>
                                    <td>
                                        @item.RequestId
                                    </td>
                                    <td>
                                        @item.Surcharge
                                    </td>
                                    <td>
                                        <button type="button" id="btnPay" class="btnViewReceipt btn-process-recharge1 btn-process-recharge2" style="background-color:green;color:white;font-weight:700;border-color: aliceblue;padding: 3px 16px;">View Receipt</button>

                                    </td>
                                </tr>
                            }
                        }

                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>


@*<script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js" asp-append-version="true"></script>*@
<script>

    $(document).ready(function () {
        var table = $('#example').DataTable({
            rowReorder: {
                selector: 'td:nth-child(2)'
            },
            responsive: true
        });

    });

</script>

<script>
    $(document).ready(function () {
        $("#example").on('click', ".btnViewReceipt", function () {
            debugger;
            var table = $('#example').DataTable();
            var d = table.row(this).data();
            var currentRow = $(this).closest('tr');
            var finoDMTModel = {
                BankCharges: d[14],
                BankName: d[15],
                BankRRNNumber: d[7],
                ClientUniqueId: d[10],
                CommissionAmount: d[12],
                IfscCode: d[17],
                Reason: d[20],
                ReceiverAccountNo: d[16],
                ReceiverMobileNumber: d[18],
                ReceiverName: d[13],
                RedmilReferenceId: d[8],
                RequestDate: d[2],
                RequestTime: d[3],
                SenderMobileNumber: d[4],
                SenderName: d[1],
                SrNo: d[0],
                Status: d[6],
                TransactionAmount: d[5],
                TransactionType: d[19],
                WalletType: d[11],
                DEName: d[21],
                DEMobile: d[22],
                RequestId: d[23],
                Surcharge: d[24],
                TransactionID:d[9],

            }
            var subCat = "31";
            var result = {
                "FinoDMTModel": finoDMTModel,
            }
            $.ajax({

                type: "POST",
                url: "/MyBusinessReports/ViewReceipt",
                data: { result, subCat },
                dataType: 'json',
                success: function (msgdeserialize) {
                    debugger;
                    var viewReceipt = msgdeserialize;
                    var viewReceiptWindow = window.open();
                    viewReceiptWindow.document.write(viewReceipt);
                    viewReceiptWindow.print();
                },
                failure: function (msgdeserialize) {
                    alert(msgdeserialize.responseText);
                },
                error: function (msgdeserialize) {
                    alert(msgdeserialize.responseText);
                }
            });

        });
    });
</script>